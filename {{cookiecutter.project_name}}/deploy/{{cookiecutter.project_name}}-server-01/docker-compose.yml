version: '3'
services:
    {{cookiecutter.app_name}}-be:
        container_name: {{cookiecutter.app_name}}-be
        image: {{cookiecutter.app_name}}-be:latest
        build: .
        restart: always
        privileged: true
        command: gunicorn {{cookiecutter.app_name}}.wsgi:app --workers=5 --worker-class gevent -t300 -b 0.0.0.0:5000
        networks:
            {{cookiecutter.app_name}}_net:
                aliases:
                    - {{cookiecutter.app_name}}-be
        environment:
            - USER_ID=${USER_ID}
        env_file:
            - ./${ENV_FILE_NAME}
        volumes:
            - ./workspace/logs:/opt/{{cookiecutter.app_name}}/logs
            - ./workspace/data:/opt/{{cookiecutter.app_name}}/data
    {{cookiecutter.app_name}}-fe:
        container_name: {{cookiecutter.app_name}}-fe
        image: {{cookiecutter.app_name}}-fe:latest
        build: ./nginx
        restart: always
#        user: ${USER_ID}
        networks:
            {{cookiecutter.app_name}}_net:
                aliases:
                    - {{cookiecutter.app_name}}-fe
        ports:
            - "80:80"
        volumes:
            - "./nginx/default.conf:/etc/nginx/conf.d/default.conf"
networks:
    {{cookiecutter.app_name}}_net: